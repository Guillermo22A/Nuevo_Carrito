<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control | Memo Project</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚òÄÔ∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" class="main-container">
        
        <header class="sunny-card header-bar">
            <div class="logo-area"><h1>‚òÄÔ∏è Control</h1></div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-link active">CONTROL</a>
                <a href="monitor.html" class="nav-link">MONITOR</a>
            </nav>
            <div class="unit-selector">
                <select v-model="unitId"><option>Memo_Bot_1</option><option>Memo_Bot_2</option></select>
            </div>
        </header>

        <div v-if="activeAlert" class="alert-banner">
            <h2>‚ö†Ô∏è OBST√ÅCULO: {{ activeAlertVal }} cm</h2>
        </div>

        <div class="grid-layout">
            <div class="left-col">
                <div class="sunny-card control-panel">
                    <h3>üïπÔ∏è Mando Manual</h3>
                    <div class="d-pad">
                        <button class="btn" @click="send('Q')">‚Üñ</button><button class="btn btn-primary" @click="send('F')">‚ñ≤</button><button class="btn" @click="send('E')">‚Üó</button>
                        <button class="btn btn-primary" @click="send('L')">‚óÄ</button><button class="btn btn-danger" @click="send('X')">üõë</button><button class="btn btn-primary" @click="send('R')">‚ñ∂</button>
                        <button class="btn" @click="send('Z')">‚Üô</button><button class="btn btn-primary" @click="send('B')">‚ñº</button><button class="btn" @click="send('C')">‚Üò</button>
                        <button class="btn btn-action" @click="send('Y')">‚Ü∫</button><div></div><button class="btn btn-action" @click="send('U')">‚Üª</button>
                    </div>
                    <div class="speed-control">
                        <label>VELOCIDAD</label>
                        <div class="speed-buttons">
                            <button class="btn-speed" :class="{active: speed===130}" @click="speed=130">Lento</button>
                            <button class="btn-speed" :class="{active: speed===180}" @click="speed=180">Normal</button>
                            <button class="btn-speed" :class="{active: speed===255}" @click="speed=255">R√°pido</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="sunny-card mission-planner">
                    <h3>üöÄ Misiones</h3>
                    <div class="input-group"><input v-model="missionName" placeholder="Nombre de Misi√≥n"></div>
                    
                    <div class="step-builder">
                        <select v-model="newStepCmd" style="flex:2">
                            <option value="F">Adelante</option><option value="B">Atr√°s</option>
                            <option value="L">Giro Izq</option><option value="R">Giro Der</option>
                            <option value="X">Pausa</option>
                        </select>
                        <input type="number" v-model="newStepTime" placeholder="ms" style="flex:1" min="100" step="100">
                        <button class="btn-add" @click="addStep">+</button>
                    </div>

                    <div class="steps-container">
                        <div v-if="visualSteps.length === 0" style="text-align:center; color:#aaa; padding:10px;">Sin pasos</div>
                        <div v-for="(s,i) in visualSteps" :key="i" class="step-item">
                            <span>{{i+1}}. <strong>{{ mapAction(s.cmd) }}</strong> ({{s.time}}ms)</span>
                            <span @click="removeStep(i)" class="del">‚ùå</span>
                        </div>
                    </div>

                    <button class="btn-full btn-warm" @click="saveMission" :disabled="visualSteps.length==0">GUARDAR</button>
                    <hr class="divider">
                    
                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <select v-model="selectedMissionId" style="margin:0;">
                            <option value="0">Seleccionar...</option>
                            <option v-for="m in savedMissions" :value="m.mission_id">#{{m.mission_id}} {{ m.title }}</option>
                        </select>
                        <button class="btn-delete" @click="deleteMission" v-if="selectedMissionId!=0">üóëÔ∏è</button>
                    </div>
                    <button class="btn-full btn-run" @click="runSelected" :disabled="selectedMissionId==0">‚ñ∂ EJECUTAR</button>
                </div>
            </div>
        </div>

        <footer class="main-footer">Memo Project v1.1</footer>
    </div>
    <script src="app.js"></script>
</body>
</html>
